var select_area_uuid;var current_page;var settings={align:"center",top:150,width:600,padding:10,backgroundColor:"white",source:"",borderColor:"#333333",borderWeight:4,borderRadius:5,fadeOutTime:300,disableColor:"#666666",disableOpacity:40,loadingImage:""};jQuery(function(){settings.loadingImage=getContextPath()+"/js/popup/loading.gif";init_numberPaging(7,7,refreshCommunities);jQuery.ajaxSetup({cache:false});jQuery("#tree").jstree({"json_data":{"ajax":{"method":"POST","url":"areatree.html","data":function(A){return{"uuid":A.attr?A.attr("id"):""}}}},"themes":{"theme":"classic","dots":true,"icons":true},contextmenu:{items:customMenu},"plugins":["themes","json_data","ui","core","crrm","cookies","contextmenu"]}).bind("select_node.jstree",function(A,B){select_area_uuid=B.rslt.obj.attr("id");jQuery("#areaName").html("地区&nbsp;&nbsp;:&nbsp;&nbsp;"+B.rslt.obj.attr("path"));refreshCommunities(1,tableRows)});jQuery(document).keyup(function(A){if(A.keyCode==27){closePopup(settings.fadeOutTime)}})});function openAreaDialog(B,A){settings.top=150;settings.source="areaform.html?method="+A+"&uuid="+B;openModalPopup(settings)}function openModalPopup(A){modalPopup(A.align,A.top,A.width,A.padding,A.disableColor,A.disableOpacity,A.backgroundColor,A.borderColor,A.borderWeight,A.borderRadius,A.fadeOutTime,A.source,A.loadingImage)}function customMenu(A){var B={"createItem":{"label":"创建目录","action":function(){openAreaDialog(A.attr("id"),"add")}},"editItem":{"label":"修改目录","action":function(C){openAreaDialog(C.attr("id"),"edit")}},"deleteItem":{"label":"删除目录","action":function(C){$.ajax({type:"post",url:"areadeletecheck.html",data:{uuid:C.attr("id")},success:function(D){if("true"==D.message){if(confirm("你要删除该目录吗?")){$.ajax({type:"post",url:"areadelete.html",data:{uuid:C.attr("id")},success:function(G){if("true"==G.message){var E=jQuery.jstree._reference("#tree");var H=E._get_node(null,false);var F=E._get_parent(H);E.refresh(F)}else{alert("删除失败!")}}})}}else{alert("对不起，该地区包含子地区或者小区，不能删除!")}}})}}};if($(A).hasClass("folder")){delete B.deleteItem}return B}function addCommunityDialog(){settings.top=100;settings.source="communityform.html?method=add&areaUuid="+select_area_uuid;openModalPopup(settings)}function saveArea(A){var B=jQuery("#name").val();if(B==null||B==""){jQuery("#areaName_help").css("display","block")}else{jQuery("#areaName_help").css("display","none");A.submit()}}function saveCommunity(){var C=jQuery("#communityUuid").val();var A=jQuery("#areaUuid").val();var D=jQuery("#communityName").val();var B=jQuery("#abbreviation").val();var E=jQuery("#comment").val();if(D==null||D==""){jQuery("#communityName_help").css("display","block")}else{jQuery("#communityName_help").css("display","none");$.ajax({url:"communityform.html",type:"POST",data:{uuid:C?C:"",areaUuid:A?A:"",name:D?D:"",abbreviation:B?B:"",comment:E?E:""},dataType:"json",cache:false,success:function(F){if(F==null||typeof(F.result)=="undefined"||F.result=="false"){alert("saveCommunity 失败！")}else{refreshCommunities(current_page,tableRows)}closePopup(settings.fadeOutTime)}})}}function refreshCommunities(B,A){jQuery.ajax({type:"post",url:"getcommunities.html",data:{areaUuid:select_area_uuid?select_area_uuid:"",name:"",currentPage:B,rows:A},success:function(C){if(C!=null&&typeof(C)!="undefined"){var E=C.rows;var F="";if(E!=null&&typeof(E)!="undefined"){for(var J=0;J<E.length;J++){var H=E[J].comment?E[J].comment:"-";var I=E[J].abbreviation?E[J].abbreviation:"-";var G='<a class="button blueB" href="boxinfomanagement.html?communityUuid='+E[J].uuid+'"><span>编辑</span></a>';F+="<tr>";F+="<td>"+E[J].num+"</td>";F+="<td>"+E[J].timestamp+"</td>";F+="<td>"+E[J].name+"</td>";F+="<td>"+I+"</td>";F+="<td>"+H+"</td>";F+="<td>"+G+"</td>";F+="</tr>"}}var K=Math.ceil(parseInt(C.total)/A);var D=generatePagingHtml(B,K,getTableRows());jQuery("#communityBody").html(F);jQuery("#tablePaging").html(D);current_page=B}}})};